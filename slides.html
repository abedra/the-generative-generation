<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>The Generative Generation</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="The Generative Generation"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-03-16 09:43:53 PDT"/>
<meta name="author" content="Aaron Bedra"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>

<link rel="stylesheet" type="text/css" href="common.css" />
<link rel="stylesheet" type="text/css" href="screen.css" media="screen" />
<link rel="stylesheet" type="text/css" href="projection.css" media="projection" />
<link rel="stylesheet" type="text/css" href="presenter.css" media="presenter" />


</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">The Generative Generation</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 The Generative Generation</a>
<ul>
<li><a href="#sec-1-1">1.1 Start with the shell of a scoring function</a></li>
<li><a href="#sec-1-2">1.2 Experiment with comparing data</a></li>
<li><a href="#sec-1-3">1.3 Write exact-matches</a></li>
<li><a href="#sec-1-4">1.4 Let's look at frequencies</a></li>
<li><a href="#sec-1-5">1.5 Merging the results</a></li>
<li><a href="#sec-1-6">1.6 Write unordered-matches</a></li>
<li><a href="#sec-1-7">1.7 Finally, combine and create the score function</a></li>
<li><a href="#sec-1-8">1.8 But WHERE ARE THE TESTS, you ask..</a></li>
<li><a href="#sec-1-9">1.9 math.combinatorics</a></li>
<li><a href="#sec-1-10">1.10 We can look at all the possible combinations</a></li>
<li><a href="#sec-1-11">1.11 And turn it into a function</a></li>
<li><a href="#sec-1-12">1.12 Writing a real test</a></li>
<li><a href="#sec-1-13">1.13 Giving it a spin</a></li>
<li><a href="#sec-1-14">1.14 Manually examine the data</a></li>
<li><a href="#sec-1-15">1.15 You want me to do what?</a></li>
<li><a href="#sec-1-16">1.16 Experimenting with test.generative</a></li>
<li><a href="#sec-1-17">1.17 Create a random secret function</a></li>
<li><a href="#sec-1-18">1.18 Define a set of functions used to test the scorer</a></li>
<li><a href="#sec-1-19">1.19 Test functions continued</a></li>
<li><a href="#sec-1-20">1.20 Define some test data and run the new functions</a></li>
<li><a href="#sec-1-21">1.21 Create a full test.generative test</a></li>
<li><a href="#sec-1-22">1.22 run test</a></li>
<li><a href="#sec-1-23">1.23 What happens when a test fails?</a></li>
<li><a href="#sec-1-24">1.24 You can paste the form in to find your problem</a></li>
<li><a href="#sec-1-25">1.25 Practical cases</a></li>
<li><a href="#sec-1-26">1.26 Another</a></li>
<li><a href="#sec-1-27">1.27 And of course</a></li>
<li><a href="#sec-1-28">1.28 References</a></li>
<li><a href="#sec-1-29">1.29 Questions?</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> The Generative Generation &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Start with the shell of a scoring function &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-1">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">exact-matches</span>
  <span style="color: #8b2252;">"Given two collections, return the number of</span>
<span style="color: #8b2252;">   positions where the collections contain equal</span>
<span style="color: #8b2252;">   items."</span>
  [c1 c2])
</pre>

</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Experiment with comparing data &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-2">




<pre class="src src-clojure">(<span style="color: #a0522d;">require</span> '[clojure.data <span style="color: #008b8b;">:as</span> data])
(data/diff [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:b</span>])
</pre>


<pre class="example">
user=&gt; [[nil :g :g] [nil :y :y] [:r nil nil :b]]
</pre>


</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Write exact-matches &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-3">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">exact-matches</span>
  <span style="color: #8b2252;">"Given two collections, return the number of</span>
<span style="color: #8b2252;">   positions where the collections contain equal</span>
<span style="color: #8b2252;">   items."</span>
  [c1 c2]
  (<span style="color: #483d8b;">let</span> [[_ _ matches] (data/diff c1 c2)]
    (<span style="color: #a0522d;">count</span> (<span style="color: #a0522d;">remove</span> nil? matches))))

(exact-matches [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:b</span>])
</pre>


<pre class="example">
user=&gt; 2
</pre>


</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Let's look at frequencies &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-4">




<pre class="src src-clojure">(<span style="color: #7f007f;">def</span> <span style="color: #0000ff;">example-secret</span> [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>])
(<span style="color: #7f007f;">def</span> <span style="color: #0000ff;">example-guess</span> [<span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:g</span>])

(frequencies example-guess)
(frequencies example-secret)  
</pre>


<pre class="example">
user=&gt; {:y 3, :g 1}
user=&gt; {:r 1, :g 2, :b 1}
</pre>


</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Merging the results &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-5">




<pre class="src src-clojure">(<span style="color: #a0522d;">select-keys</span> (frequencies example-secret)
             example-guess)

(<span style="color: #a0522d;">select-keys</span> (frequencies example-guess)
             example-secret)

(<span style="color: #a0522d;">merge-with</span> min {<span style="color: #008b8b;">:g</span> 1} {<span style="color: #008b8b;">:g</span> 2})
</pre>


<pre class="example">
user=&gt; {:g 2}
user=&gt; {:g 1}
user=&gt; {:g 1}
</pre>


</div>

</div>

<div id="outline-container-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Write unordered-matches &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-6">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">unordered-matches</span>
  <span style="color: #8b2252;">"Given two collections, return a map where each </span>
<span style="color: #8b2252;">   key is an item in both collections, and each</span>
<span style="color: #8b2252;">   value is the minumum number of occurrences"</span>
  [c1 c2]
  (<span style="color: #483d8b;">let</span> [f1 (<span style="color: #a0522d;">select-keys</span> (frequencies c1) c2)
        f2 (<span style="color: #a0522d;">select-keys</span> (frequencies c2) c1)] 
    (<span style="color: #a0522d;">merge-with</span> min f1 f2)))

(unordered-matches [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] [<span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:g</span>])
</pre>


<pre class="example">
user=&gt; {:g 1}
</pre>


</div>

</div>

<div id="outline-container-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Finally, combine and create the score function &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-7">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">score</span> [c1 c2]
  (<span style="color: #483d8b;">let</span> [exact (exact-matches c1 c2)
        unordered (<span style="color: #a0522d;">apply</span> +
                    (<span style="color: #a0522d;">vals</span>
                      (unordered-matches c1 c2)))]
    {<span style="color: #008b8b;">:exact</span> exact <span style="color: #008b8b;">:unordered</span> (<span style="color: #a0522d;">-</span> unordered exact)}))

(score [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:g</span>])
</pre>


<pre class="example">
user=&gt; {:exact 1, :unordered 1}
</pre>


</div>

</div>

<div id="outline-container-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> But WHERE ARE THE TESTS, you ask.. &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-8">

</div>

</div>

<div id="outline-container-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> math.combinatorics &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-9">




<pre class="src src-clojure">(<span style="color: #a0522d;">require</span> '[clojure.math.combinatorics <span style="color: #008b8b;">:as</span> comb])
(comb/selections [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] 2)
</pre>


<pre class="example">
user=&gt; ((:r :r) (:r :g) (:r :b) (:g :r) 
        (:g :g) (:g :b) (:b :r) (:b :g) (:b :b))
</pre>


</div>

</div>

<div id="outline-container-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> We can look at all the possible combinations &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-10">




<pre class="src src-clojure">(<span style="color: #483d8b;">-&gt;</span> (comb/selections [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] 2)
    (comb/selections 2))
</pre>


<pre class="example">
user=&gt; (((:r :r) (:r :r)) ((:r :r) (:r :g)) 
        ((:r :r) (:r :b)) ((:r :r) (:g :r)) 
        ((:r :r) (:g :g)) ((:r :r) (:g :b)) 
        ...
        ((:b :b) (:b :g)) ((:b :b) (:b :b)))
</pre>



</div>

</div>

<div id="outline-container-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> And turn it into a function &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-11">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">generate-turn-inputs</span>
  <span style="color: #8b2252;">"Generate all possible turn inputs for a</span>
<span style="color: #8b2252;">   clojurebreaker game with colors and n columns"</span>
  [colors n]
  (<span style="color: #483d8b;">-&gt;</span> (comb/selections colors n)
      (comb/selections 2)))
</pre>

</div>

</div>

<div id="outline-container-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> Writing a real test &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-12">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">score-inputs</span>
  <span style="color: #8b2252;">"Given a sequence of turn inputs, return a lazy</span>
<span style="color: #8b2252;">   sequence of maps with :secret, :guess, and</span>
<span style="color: #8b2252;">   :score."</span>
  [inputs]
  (<span style="color: #a0522d;">map</span>
   (<span style="color: #a0522d;">fn</span> [[secret guess]]
     {<span style="color: #008b8b;">:secret</span> (<span style="color: #a0522d;">seq</span> secret)
      <span style="color: #008b8b;">:guess</span> (<span style="color: #a0522d;">seq</span> guess)
      <span style="color: #008b8b;">:score</span> (score secret guess)})
   inputs))
</pre>

</div>

</div>

<div id="outline-container-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> Giving it a spin &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-13">




<pre class="src src-clojure">(<span style="color: #483d8b;">-&gt;&gt;</span> (generate-turn-inputs [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>] 2)
     (score-inputs))
</pre>


<pre class="example">
user=&gt; ({:secret (:r :r), :guess (:r :r), 
         :score {:exact 2, :unordered 0}} 
        {:secret (:r :r), :guess (:r :g), 
         :score {:exact 1, :unordered 0}}
        ....
        {:secret (:b :b), :guess (:b :b), 
         :score {:exact 2, :unordered 0}})
</pre>


</div>

</div>

<div id="outline-container-1-14" class="outline-3">
<h3 id="sec-1-14"><span class="section-number-3">1.14</span> Manually examine the data &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-14">




<pre class="src src-clojure">(<span style="color: #a0522d;">use</span> 'clojure.pprint)
(<span style="color: #a0522d;">require</span> '[clojure.java.io <span style="color: #008b8b;">:as</span> io])
(<span style="color: #483d8b;">with-open</span> [w (io/writer <span style="color: #8b2252;">"scoring-table"</span>)]
  (<span style="color: #483d8b;">binding</span> [*out* w]
    (print-table
     (<span style="color: #483d8b;">-&gt;&gt;</span> (generate-turn-inputs [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span> <span style="color: #008b8b;">:y</span>] 4)
          (score-inputs)))))
</pre>

</div>

</div>

<div id="outline-container-1-15" class="outline-3">
<h3 id="sec-1-15"><span class="section-number-3">1.15</span> You want me to do what? &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-15">



<pre class="example">
========================================================
:secret       | :guess        | :score                  
========================================================
(:r :r :r :r) | (:r :r :r :r) | {:exact 4, :unordered 0}
(:r :r :r :r) | (:r :r :r :g) | {:exact 3, :unordered 0}
(:r :r :r :r) | (:r :r :r :b) | {:exact 3, :unordered 0}
(:r :r :r :r) | (:r :r :r :y) | {:exact 3, :unordered 0}
....
(:y :y :y :y) | (:y :y :y :b) | {:exact 3, :unordered 0}
(:y :y :y :y) | (:y :y :y :y) | {:exact 4, :unordered 0}
========================================================
</pre>



</div>

</div>

<div id="outline-container-1-16" class="outline-3">
<h3 id="sec-1-16"><span class="section-number-3">1.16</span> Experimenting with test.generative &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-16">




<pre class="src src-clojure">(<span style="color: #a0522d;">require</span> '[clojure.test.generative.generators <span style="color: #008b8b;">:as</span> gen])
(gen/vec gen/boolean)
(gen/hash-map gen/byte gen/int)
</pre>


<pre class="example">
user=&gt; [false true false false true true false false 
        true true false false true false true false false]
user=&gt; {-65 -1280904780, 96 193928749, 4 835628727, 
        -69 1265123962, 38 740672507, 42 -872871511}
</pre>





<pre class="src src-clojure">(gen/geometric 0.02)
(gen/list gen/int 2)
(gen/list gen/int (gen/uniform 0 5))
</pre>


<pre class="example">
user=&gt; 42
user=&gt; (278318889 -909716267)
user=&gt; (-1880284059 -442888494 -98097322 1681870739)
</pre>



</div>

</div>

<div id="outline-container-1-17" class="outline-3">
<h3 id="sec-1-17"><span class="section-number-3">1.17</span> Create a random secret function &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-17">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">random-secret</span> []
  (gen/vec #(gen/one-of <span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span> <span style="color: #008b8b;">:y</span>) 4))

(random-secret)
</pre>


<pre class="example">
user=&gt; [:b :y :b :r]
</pre>


</div>

</div>

<div id="outline-container-1-18" class="outline-3">
<h3 id="sec-1-18"><span class="section-number-3">1.18</span> Define a set of functions used to test the scorer &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-18">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">matches</span>
  [score]
  (<span style="color: #a0522d;">+</span> (<span style="color: #008b8b;">:exact</span> score) (<span style="color: #008b8b;">:unordered</span> score)))

(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">scoring-is-symmetric</span>
  [secret guess sc]
  (<span style="color: #a0522d;">=</span> sc (score guess secret)))

(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">scoring-is-bounded-by-number-of-pegs</span> 
  [secret guess score]
  (<span style="color: #a0522d;">&lt;=</span> 0 (matches score) (<span style="color: #a0522d;">count</span> secret)))
</pre>

</div>

</div>

<div id="outline-container-1-19" class="outline-3">
<h3 id="sec-1-19"><span class="section-number-3">1.19</span> Test functions continued &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-19">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">reordering-the-guess-does-not-change-matches</span>
  [secret guess sc]
  (<span style="color: #a0522d;">=</span> #{(matches sc)}
     (<span style="color: #a0522d;">into</span> #{}
           (<span style="color: #a0522d;">map</span>
            #(matches (score secret %))
            (comb/permutations guess)))))
</pre>

</div>

</div>

<div id="outline-container-1-20" class="outline-3">
<h3 id="sec-1-20"><span class="section-number-3">1.20</span> Define some test data and run the new functions &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-20">




<pre class="src src-clojure">(<span style="color: #7f007f;">def</span> <span style="color: #0000ff;">secret</span> [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:b</span>])
(<span style="color: #7f007f;">def</span> <span style="color: #0000ff;">guess</span> [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:b</span> <span style="color: #008b8b;">:b</span> <span style="color: #008b8b;">:y</span>])

(scoring-is-symmetric secret guess (score secret guess))

(scoring-is-bounded-by-number-of-pegs
 secret guess (score secret guess))

(reordering-the-guess-does-not-change-matches
  secret guess (score secret guess))
</pre>


<pre class="example">
user=&gt; true
user=&gt; true
user=&gt; true
</pre>


</div>

</div>

<div id="outline-container-1-21" class="outline-3">
<h3 id="sec-1-21"><span class="section-number-3">1.21</span> Create a full test.generative test &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-21">




<pre class="src src-clojure">(<span style="color: #a0522d;">use</span> '[clojure.test.generative <span style="color: #008b8b;">:only</span> (defspec) <span style="color: #008b8b;">:as</span> test])
(defspec score-invariants
  score
  [^{<span style="color: #008b8b;">:tag</span> `random-secret} secret
   ^{<span style="color: #008b8b;">:tag</span> `random-secret} guess]
  (<span style="color: #a0522d;">assert</span> (scoring-is-symmetric secret guess %))
  (<span style="color: #a0522d;">assert</span> (scoring-is-bounded-by-number-of-pegs secret guess %))
  (<span style="color: #a0522d;">assert</span> (reordering-the-guess-does-not-change-matches
           secret guess %)))
</pre>

</div>

</div>

<div id="outline-container-1-22" class="outline-3">
<h3 id="sec-1-22"><span class="section-number-3">1.22</span> run test &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-22">




<pre class="src src-clojure">(test/test-vars #'user/score-invariants)
</pre>


<pre class="example">
user=&gt; {:iterations 1747, :msec 10004, 
        :var #'user/score-invariants, :seed 42}
       {:iterations 1748, :msec 10002, 
        :var #'user/score-invariants, :seed 46}
       {:iterations 1733, :msec 10002, 
        :var #'user/score-invariants, :seed 43}
       {:iterations 1745, :msec 10001, 
        :var #'user/score-invariants, :seed 49}
       {:iterations 1734, :msec 10004, 
        :var #'user/score-invariants, :seed 45}
       {:iterations 1762, :msec 10009, 
        :var #'user/score-invariants, :seed 44}
       {:iterations 1743, :msec 10008, 
        :var #'user/score-invariants, :seed 47}
       {:iterations 1749, :msec 10009, 
        :var #'user/score-invariants, :seed 48}
       :run-complete
</pre>


</div>

</div>

<div id="outline-container-1-23" class="outline-3">
<h3 id="sec-1-23"><span class="section-number-3">1.23</span> What happens when a test fails? &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-23">




<pre class="src src-clojure">(<span style="color: #7f007f;">defn</span> <span style="color: #0000ff;">scoring-is-bounded-by-number-of-pegs</span>
  [secret guess score]
  (<span style="color: #a0522d;">&gt;=</span> 0 (matches score) (<span style="color: #a0522d;">count</span> secret)))

(test/test-vars #'user/score-invariants)
</pre>


<pre class="example">
user=&gt; {:form (#'user/score-invariants [:g :g :g :r] 
                                       [:r :r :r :y]), 
 :iteration 0, :seed 44, 
 :error "Assert failed: (scoring-is-bounded-by-number-of-pegs 
                          secret guess %)", 
 :exception #&lt;AssertionError java.lang.AssertionError: 
   Assert failed: (scoring-is-bounded-by-number-of-pegs 
                    secret guess %)&gt;}
</pre>


</div>

</div>

<div id="outline-container-1-24" class="outline-3">
<h3 id="sec-1-24"><span class="section-number-3">1.24</span> You can paste the form in to find your problem &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-24">




<pre class="src src-clojure">(#'user/score-invariants [<span style="color: #008b8b;">:g</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:b</span> <span style="color: #008b8b;">:r</span>] [<span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:r</span> <span style="color: #008b8b;">:y</span> <span style="color: #008b8b;">:y</span>])
</pre>


<pre class="example">
user =&gt; AssertionError Assert failed: 
  (scoring-is-bounded-by-number-of-pegs 
    secret guess %)  
  user/score-invariants (NO_SOURCE_FILE:145)
</pre>

</div>

</div>

<div id="outline-container-1-25" class="outline-3">
<h3 id="sec-1-25"><span class="section-number-3">1.25</span> Practical cases &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-25">




<pre class="src src-clojure">(defspec integer-commutative-laws
  (<span style="color: #a0522d;">partial</span> map identity)
  [^{<span style="color: #008b8b;">:tag</span> `integer} a ^{<span style="color: #008b8b;">:tag</span> `integer} b]
  (<span style="color: #483d8b;">if</span> (longable? (<span style="color: #a0522d;">+</span>' a b))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">+</span> a b) (<span style="color: #a0522d;">+</span> b a)
               (<span style="color: #a0522d;">+</span>' a b) (<span style="color: #a0522d;">+</span>' b a)
               (<span style="color: #a0522d;">unchecked-add</span> a b) (<span style="color: #a0522d;">unchecked-add</span> b a)))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">+</span>' a b) (<span style="color: #a0522d;">+</span>' b a))))
  (<span style="color: #483d8b;">if</span> (longable? (<span style="color: #a0522d;">*</span>' a b))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span> a b) (<span style="color: #a0522d;">*</span> b a)
               (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' b a)
               (<span style="color: #a0522d;">unchecked-multiply</span> a b) (<span style="color: #a0522d;">unchecked-multiply</span> b a)))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' b a)))))

</pre>

</div>

</div>

<div id="outline-container-1-26" class="outline-3">
<h3 id="sec-1-26"><span class="section-number-3">1.26</span> Another &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-26">




<pre class="src src-clojure">(defspec integer-associative-laws
  (<span style="color: #a0522d;">partial</span> map identity)
  [^{<span style="color: #008b8b;">:tag</span> `integer} a ^{<span style="color: #008b8b;">:tag</span> `integer} b ^{<span style="color: #008b8b;">:tag</span> `integer} c]
  (<span style="color: #483d8b;">if</span> (<span style="color: #a0522d;">every?</span> longable? [(<span style="color: #a0522d;">+</span>' a b) (<span style="color: #a0522d;">+</span>' b c) (<span style="color: #a0522d;">+</span>' a b c)])
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">+</span> a b) c) (<span style="color: #a0522d;">+</span> a (<span style="color: #a0522d;">+</span> b c))
               (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">+</span>' a b) c) (<span style="color: #a0522d;">+</span>' a (<span style="color: #a0522d;">+</span>' b c))
               (<span style="color: #a0522d;">unchecked-add</span> (<span style="color: #a0522d;">unchecked-add</span> a b) c)
               (<span style="color: #a0522d;">unchecked-add</span> a (<span style="color: #a0522d;">unchecked-add</span> b c))))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">+</span>' a b) c) (<span style="color: #a0522d;">+</span>' a (<span style="color: #a0522d;">+</span>' b c))
               (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">bigint</span> a) b) c) (<span style="color: #a0522d;">+</span> a (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">bigint</span> b) c)))))
  (<span style="color: #483d8b;">if</span> (<span style="color: #a0522d;">every?</span> longable? [(<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' b c) (<span style="color: #a0522d;">*</span>' a b c)])
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">*</span> a b) c) (<span style="color: #a0522d;">*</span> a (<span style="color: #a0522d;">*</span> b c))
               (<span style="color: #a0522d;">*</span>' (<span style="color: #a0522d;">*</span>' a b) c) (<span style="color: #a0522d;">*</span>' a (<span style="color: #a0522d;">*</span>' b c))
               (<span style="color: #a0522d;">unchecked-multiply</span> (<span style="color: #a0522d;">unchecked-multiply</span> a b) c)
               (<span style="color: #a0522d;">unchecked-multiply</span> a (<span style="color: #a0522d;">unchecked-multiply</span> b c))))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span>' (<span style="color: #a0522d;">*</span>' a b) c) (<span style="color: #a0522d;">*</span>' a (<span style="color: #a0522d;">*</span>' b c))
               (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">bigint</span> a) b) c) (<span style="color: #a0522d;">*</span> a (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">bigint</span> b) c))))))

</pre>

</div>

</div>

<div id="outline-container-1-27" class="outline-3">
<h3 id="sec-1-27"><span class="section-number-3">1.27</span> And of course &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-27">




<pre class="src src-clojure">(defspec integer-distributive-laws
  (<span style="color: #a0522d;">partial</span> map identity)
  [^{<span style="color: #008b8b;">:tag</span> `integer} a ^{<span style="color: #008b8b;">:tag</span> `integer} b ^{<span style="color: #008b8b;">:tag</span> `integer} c]
  (<span style="color: #483d8b;">if</span> (<span style="color: #a0522d;">every?</span> longable? [(<span style="color: #a0522d;">*</span>' a (<span style="color: #a0522d;">+</span>' b c)) (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' a c))
                         (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' a c) (<span style="color: #a0522d;">+</span>' b c)])
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span> a (<span style="color: #a0522d;">+</span> b c)) (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">*</span> a b) (<span style="color: #a0522d;">*</span> a c))
               (<span style="color: #a0522d;">*</span>' a (<span style="color: #a0522d;">+</span>' b c)) (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' a c))
               (<span style="color: #a0522d;">unchecked-multiply</span> a (<span style="color: #a0522d;">+</span>' b c))
               (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">unchecked-multiply</span> a b) (<span style="color: #a0522d;">unchecked-multiply</span> a c))))
    (<span style="color: #a0522d;">assert</span> (<span style="color: #a0522d;">=</span> (<span style="color: #a0522d;">*</span>' a (<span style="color: #a0522d;">+</span>' b c)) (<span style="color: #a0522d;">+</span>' (<span style="color: #a0522d;">*</span>' a b) (<span style="color: #a0522d;">*</span>' a c))
               (<span style="color: #a0522d;">*</span> a (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">bigint</span> b) c)) (<span style="color: #a0522d;">+</span> (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">bigint</span> a) b) (<span style="color: #a0522d;">*</span> (<span style="color: #a0522d;">bigint</span> a) c))))))

</pre>

</div>

</div>

<div id="outline-container-1-28" class="outline-3">
<h3 id="sec-1-28"><span class="section-number-3">1.28</span> References &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-28">

<ul>
<li>Test Generative <a href="http://github.com/clojure/test.generative">github.com/clojure/test.generative</a>
</li>
<li>Programming Clojure, 2nd Edition <a href="http://pragprog.com/book/shcloj2/programming-clojure">pragprog.com/book/shcloj2/programming-clojure</a>
</li>
<li>Haskell's Quick Check <a href="http://www.haskell.org/haskellwiki/Introduction_to_QuickCheck">www.haskell.org/haskellwiki/Introduction<sub>to</sub><sub>QuickCheck</sub></a>
</li>
<li>John Hughes on Quick Check (Erlang) <a href="http://www.erlang.org/euc/03/proceedings/1430John.pdf">www.erlang.org/euc/03/proceedings/1430John.pdf</a>
</li>
<li>ICheck (Ioke) <a href="https://github.com/olabini/ioke/blob/master/lib/ioke/icheck.ik">github.com/olabini/ioke/blob/master/lib/ioke/icheck.ik</a>
</li>
<li>Org HTML Slideshow (ClojureScript) <a href="http://github.com/relevance/org-html-slideshow">github.com/relevance/org-html-slideshow</a>
</li>
</ul>

</div>

</div>

<div id="outline-container-1-29" class="outline-3">
<h3 id="sec-1-29"><span class="section-number-3">1.29</span> Questions? &nbsp;&nbsp;&nbsp;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-1-29">





<script type="text/javascript" src="org-html-slideshow.js"></script>

</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-03-16 09:43:53 PDT</p>
<p class="author">Author: Aaron Bedra</p>
<p class="creator">Org version 7.8.03 with Emacs version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
